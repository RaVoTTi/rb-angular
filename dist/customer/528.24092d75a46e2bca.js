"use strict";(self.webpackChunkcustomer=self.webpackChunkcustomer||[]).push([[528],{5528:(T,d,o)=>{o.r(d),o.d(d,{CheckoutModule:()=>u});var h=o(6895),n=o(5467),s=o(433),l=o(5931),p=o(5698),a=o(5780),f=o(3629),v=o(9653),t=o(4650),P=o(3900),b=o(529);class c{constructor(r,i){this.http=r,this.router=i,this.API_URL=f.N.API_URL}postMyPlaceOrder(r){return this.http.post(`${this.API_URL}/myorder/placeorder/${r}`,{}).pipe((0,P.w)(({url:i})=>window.location.href=i))}getMyPlaceOrder(r){return this.http.get(`${this.API_URL}/myorder/placeorder/${r}`)}patchCheckout(r,i){return this.http.patch(`${this.API_URL}/myorder/checkout/${r}`,{token:i}).toPromise()}getConfirmOrder(r){return this.http.get(`${this.API_URL}/myorder/confirm/${r}`)}static#t=this.\u0275fac=function(i){return new(i||c)(t.LFG(b.eN),t.LFG(n.F0))};static#r=this.\u0275prov=t.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})}var A=o(3248);class m{constructor(r,i,e,g,F,y,k,U){this.formBuilder=r,this.location=i,this.route=e,this.bookBaseService=g,this.checkoutService=F,this.alertService=y,this.router=k,this.store=U,this.RAW_URL=f.N.RAW_URL,this.couponForm=new s.NI(""),this.checkoutComplete=!1,this.init=!1}ngOnInit(){this._getBook()}back(){this.location.back()}_initForm(r,i){this.orderForm=this.formBuilder.group({price:[r,[s.kI.required,s.kI.min(r),s.kI.max(i)]]})}onSubmit(){this.checkoutService.postMyPlaceOrder(this.id).subscribe(r=>{r&&this.alertService.fire({text:"Something wrong have happened",icon:"error"})})}onSubmitCoupon(){this.couponForm.markAsTouched()}_getBook(){this.route.params.pipe((0,p.q)(1)).subscribe(r=>{r.id&&(this.id=r.id,this.store.pipe((0,v.Ys)((0,a.NK)(this.id)),(0,p.q)(1)).subscribe(i=>{i&&(this.book=i,this.minPrice=this.book.minPrice,this.maxPrice=this.book.maxPrice,this.price=this.book.minPrice,this._initForm(this.minPrice,this.maxPrice),this.init=!0)}))})}validateCamp(r){return this.orderForm.controls[r].errors&&this.orderForm.controls[r].touched}validateCoupon(){return this.couponForm.touched}getPrice(){return this.orderForm.get("price")?.value}getPriceFormated(){!this.getPrice()||this.orderForm.get("price")?.value<this.minPrice?(this.price=this.minPrice,this.orderForm.patchValue({price:this.minPrice})):this.orderForm.get("price")?.value>this.maxPrice?(this.price=this.maxPrice,this.orderForm.patchValue({price:this.maxPrice})):this.price=this.getPrice()}static#t=this.\u0275fac=function(i){return new(i||m)(t.Y36(s.qu),t.Y36(h.Ye),t.Y36(n.gz),t.Y36(a.db),t.Y36(c),t.Y36(l.c9),t.Y36(n.F0),t.Y36(v.yh))};static#r=this.\u0275cmp=t.Xpm({type:m,selectors:[["frontend-place-order"]],decls:36,vars:10,consts:[[1,"place-order"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-3"],[3,"book"],[1,"col-12","col-sm-8"],[1,"d-flex","flex-column","mt-3","mt-sm-0"],[1,"place-order-table"],[1,"table"],["scope","col"],[1,"bg-primary-light"],[1,"btn","btn-primary","mt-3",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3),t._UZ(4,"frontend-card-book",4),t.qZA(),t.TgZ(5,"div",5)(6,"div",6)(7,"div",7)(8,"table",8)(9,"thead")(10,"tr")(11,"th",9),t._uU(12,"#"),t.qZA(),t.TgZ(13,"th",9),t._uU(14,"Cost"),t.qZA()()(),t.TgZ(15,"tbody")(16,"tr")(17,"th"),t._uU(18),t.ALo(19,"titlecase"),t.qZA(),t.TgZ(20,"td"),t._uU(21),t.ALo(22,"currency"),t.qZA()(),t.TgZ(23,"tr")(24,"th"),t._uU(25,"Delivery"),t.qZA(),t.TgZ(26,"td"),t._uU(27,"FREE"),t.qZA()(),t.TgZ(28,"tr",10)(29,"th"),t._uU(30,"Total to pay"),t.qZA(),t.TgZ(31,"td"),t._uU(32),t.ALo(33,"currency"),t.qZA()()()()(),t.TgZ(34,"button",11),t.NdJ("click",function(){return e.onSubmit()}),t._uU(35,"Continue to Payment"),t.qZA()()()()()()),2&i&&(t.xp6(4),t.Q6J("book",e.book),t.xp6(14),t.Oqu(t.lcZ(19,4,e.book.name)),t.xp6(3),t.Oqu(t.lcZ(22,6,e.price)),t.xp6(11),t.Oqu(t.lcZ(33,8,e.price)))},dependencies:[A.b,h.rS,h.H9],encapsulation:2})}const Z=[{path:"placeorder/:id",component:m,resolve:{books:a.Kt}}];class u{static#t=this.\u0275fac=function(i){return new(i||u)};static#r=this.\u0275mod=t.oAB({type:u});static#i=this.\u0275inj=t.cJS({imports:[a.rG,h.ez,s.UX,l.As,n.Bz.forChild(Z)]})}}}]);